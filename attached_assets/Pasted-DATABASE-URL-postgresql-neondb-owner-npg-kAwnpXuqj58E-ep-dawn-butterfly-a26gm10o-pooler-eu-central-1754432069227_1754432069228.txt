DATABASE_URL=postgresql://neondb_owner:npg_kAwnpXuqj58E@ep-dawn-butterfly-a26gm10o-pooler.eu-central-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require
Вот тебе база и скрин как выглядеть должен Excel. Начнем. Проверь сначало создается ли сессия отдельная по телеграм id чтобы не перемешивались базы данные, также там вроде в базах присутствует slug который почти нигде не используется проверь пользуется ли он в коде и зачем он? Итак при загрузке скриншота Gemini вытаскивает предметы, количество дальше по предметам оно ищет в API warframe market предметы и возвращается цена на продажу и покупку. В итоге база имеет Название - Количество (от gemini или если вещь дублировалась ранее и она плюсуется тоже проверь это) - Цена продажи (5 цифр) - Цена покупки - Сердняя цена продажи - ссылка. Все правильно? Все это выгружается в Базу данных postgre и при нажатии "завершение сессии" оно создаст Excel файл? Все ли верно проверь.!!!. Дальше при редактировании функции Excel пользователь выгружает свой Excel (например с 5-ю предметами) он должен нормально выгрузиться и оно будет в базе дальше пользователь может скриншотами много раз подряд или одним сообщением (пару скринов сразу) и оно все закинет в базу данных (ПОПОЛНИТ, продублирует если есть копии) и так далее, если скриншот дальше идет то оно снова добавит, а не заменит! Итого после завершения сессии все очищается в базе и дается Excel. Проверь все что я написал правда? Проверь от начала Gemini - потом Api waframe market - потом создание в базе таблиц (гайд создай) где есть сессия, предметы и все корректно пополняется. дальше можно или выгрузить или дальше пополнить. (БЫЛА РАНЕЕ ПРОБЛЕМА ПРОВЕРЬ ТОЖЕ что если предмета присутствует на двух разных скриншотах то оно вместо добавлять количество просто дублировало его в Excel в отдельный столб ПОТОМУ ЧТО у них разная оказалсь цена при выгрузке цены из Warframe market) понял в чем проблема? Пусть если цена отличается при парсинге и поиске то она заменяется на новую! И предмет корректно добавлял количетсов 1+1 ,а если количество было 3 и на следующем скриншоте тоже 3 этого же предмета то будет 6 ведь (3+3=6) понял?